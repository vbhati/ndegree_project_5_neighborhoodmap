function initialize(a){navigator.geolocation?navigator.geolocation.getCurrentPosition(createMap,geoError,a):alert("Geolocation is not supported for this Browser version.")}function geoError(a){switch(console.log("Error occurred. Error code: "+a.code),a.code){case 0:alert("Unknown Error. Please try again later.");break;case 1:console.log("Permission Denied."),latitude=37.3847625,longitude=-122.088205,createMap(null);break;case 2:alert("Position Unavailable.");break;case 3:alert("Service Timed out.");break;default:alert("Oops!! There is some issue. Please try again later.")}}function createMap(a){null!==a&&(latitude=a.coords.latitude,longitude=a.coords.longitude);var b={disableDefaultUI:!1};if(void 0===map)map=new google.maps.Map(document.querySelector("#map"),b);else if(markersArray)for(var c=0;c<markersArray.length;c++)markersArray[c].marker().setMap(null),markersArray[c].infobox().close();var d=new google.maps.Geocoder,e=new google.maps.LatLng(latitude,longitude),f=!1;d.geocode({latLng:e},function(a,b){if(b==google.maps.GeocoderStatus.OK){for(var c=a[0].address_components,d=0;d<c.length;++d){for(var e=c[d].types,g=0;g<e.length;++g)if("locality"==e[g]){city=c[d].long_name,f=!0;break}if(f)break}fetchData()}else alert("Geocoder failed due to: "+b)})}function fetchData(){var a="https://api.foursquare.com/v2/venues/explore?client_id=NGDMJK52C2E24XBBXUBJAVGY0JZ5NXEQLYSXP4WEXXN5SKRJ&client_secret=ULZX0RYWBOZIMK4DF30TX0S42CSJSP1FUTOG2HF0ERCBSKDI&v=20130815%20&limit=15&near="+city+"&section=coffee&radius=500";$.ajax({url:a,dataType:"json",success:function(a){dataFromServer=a.response.groups[0].items,getNearbyCities()}}).error(function(){alert("Data Can't be loaded at present. Please try again later.")})}function getNearbyCities(){var a="http://api.geonames.org/findNearbyPlaceNameJSON?lat="+latitude+"&lng="+longitude+"&username=wolverine&cities=cities15000&radius=10";$.ajax({url:a,dataType:"json",success:function(a){geonames=a.geonames,processData()}}).error(function(){alert("List of nearby cities can't be loaded please try again later.")})}function processData(){function a(a){var b=document.createElement("div");return b.style.cssText="border: 1px solid black; margin-top: 8px; background: rgb(55, 55, 55);padding: 5px; border-radius:5px;",b.innerHTML=null!==a.parent.url()&&void 0!==a.parent.url()?'<div class="infobox_heading"><img class="coffee-image" src="./images/coffee-icon.png"alt="Location image"><a class="venue_name" href="'+a.parent.url()+'" target="_blank">'+a.parent.name()+"</a></div>":'<div class="infobox_heading"><img class="coffee-image" src="./images/coffee-icon.png"alt="Location image"><a class="venue_name" href=#>'+a.parent.name()+"</a></div>",b.innerHTML+='<div><h3 class="venue_info">'+a.parent.street()+'</h3><h3 class="venue_info">'+a.parent.city()+'</h3><h3 class="venue_info">'+a.parent.country()+"</h3>",null!==a.parent.phone()&&void 0!==a.parent.phone()&&(b.innerHTML+='<div><h3 class="venue_info">'+a.parent.phone()+"</h3></div>"),null!==a.parent.ratings()&&void 0!==a.parent.ratings()&&(b.innerHTML+='<div><img class="rating_img" src="./images/foursquare.png"alt="Location image"><span class="venue_info">  Ratings : '+a.parent.ratings()+"</span></div>"),b}var b=function(){var a=this;a.filter=ko.observable("");var b=!1;a.dataList=ko.observableArray([]),a.nearbyCities=ko.observableArray([]),popupItem=!1,dataFromServer.forEach(function(b){a.dataList.push(new c(b))}),geonames.forEach(function(b){b.name!=city&&a.nearbyCities.push(new e(b))}),a.filteredList=ko.computed(function(){var c=a.filter().toLowerCase();if(c)return ko.utils.arrayFilter(a.dataList(),function(a){a.mapMarker().marker().setMap(null),null!==info&&void 0!==info&&info.close(),b=!0;var d=a.name().toLowerCase();return d.indexOf(c)>=0?(a.mapMarker().marker().setMap(map),google.maps.event.addListener(a.mapMarker().marker(),"click",function(){a.mapMarker().infobox().open(map,a.mapMarker().marker())}),a):void 0});if(b===!0){for(var d=0;d<a.dataList().length;d++)a.dataList()[d].mapMarker().marker().setMap(map);return a.dataList()}return a.dataList()}),a.showClickedItem=function(a){if(null!==info&&void 0!==info&&info.close(),a.mapMarker().infobox().open(map,a.mapMarker().marker()),info=a.mapMarker().infobox(),void 0!==window.innerWidth){var b=window.innerWidth;420>=b&&drawer.classList.remove("open")}},a.updateData=function(a){latitude=a.lat,longitude=a.lng,ko.cleanNode(document.body),createMap(null)}},c=function(a){var b=this,c=a.venue;b.name=ko.observable(c.name),b.street=ko.observable(c.location.formattedAddress[0]),b.city=ko.observable(c.location.formattedAddress[1]),b.country=ko.observable(c.location.formattedAddress[2]),b.phone=ko.observable(c.contact.formattedPhone),b.ratings=ko.observable(c.rating),b.url=ko.observable(c.url),b.lat=ko.observable(c.location.lat),b.lng=ko.observable(c.location.lng),b.id=ko.observable(c.id),b.mapMarker=ko.observable(new d(b))},d=function(b){var c=this;c.parent=b,c.marker=ko.computed(function(){var a=new google.maps.Marker({map:map,position:new google.maps.LatLng(b.lat(),b.lng()),title:b.name(),icon:image});return a}),c.infobox=ko.computed(function(){var b=a(c),d=new InfoBox({content:b,disableAutoPan:!1,maxWidth:200,pixelOffset:new google.maps.Size(-140,0),zIndex:null,boxStyle:{background:"url('http://google-maps-utility-library-v3.googlecode.com/svn/trunk/infobox/examples/tipbox.gif') no-repeat",opacity:.75,width:"200px"},closeBoxMargin:"12px 4px 2px 2px",closeBoxURL:"http://www.google.com/intl/en_us/mapfiles/close.gif",infoBoxClearance:new google.maps.Size(1,1)});return markersArray.push(c),d}),google.maps.event.addListener(c.marker(),"click",function(){c.infobox().open(map,c.marker())}),popupItem||(c.infobox().open(map,c.marker()),popupItem=!0,info=c.infobox());var d=window.mapBounds;d.extend(new google.maps.LatLng(b.lat(),b.lng())),map.fitBounds(d),map.setCenter(d.getCenter())},e=function(a){var b=this;b.name=a.name,b.lat=a.lat,b.lng=a.lng};ko.applyBindings(new b)}var map,latitude,longitude,dataFromServer,city,geonames,markersArray=[],image="images/coffee.png",menu,mapBgrd,drawer,info,popupItem;$(document).ready(function(){window.mapBounds=new google.maps.LatLngBounds,window.addEventListener("resize",function(a){map.fitBounds(mapBounds)}),menu=document.querySelector("#menu"),mapBgrd=document.querySelector("#map"),drawer=document.querySelector("#drawer"),menu.addEventListener("click",function(a){drawer.classList.toggle("open"),a.stopPropagation()}),mapBgrd.addEventListener("click",function(){drawer.classList.remove("open")});var a={maximumAge:3e5};initialize(a)});